<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G·ª≠i Trao NƒÉm M·ªõi 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;1,400&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- GLOBAL RESET & FONTS --- */
        :root {
            --bg-night: #0a0a0a;
            --text-gold: #ffbd69;
            --accent-red: #8a2323;
            --fire-glow: rgba(255, 120, 0, 0.6);
            --paper-bg: #fdfaf1;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Lora', serif;
            background-color: var(--bg-night);
            color: #fff;
            overflow: hidden; /* NgƒÉn cu·ªôn trang ch√≠nh */
            height: 100vh;
            width: 100vw;
            /* Ch·ªëng rung khi scroll tr√™n mobile */
            overscroll-behavior: none; 
        }

        /* --- BACKGROUND SAO & SAO BƒÇNG --- */
        #star-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -2;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            overflow: hidden;
        }
        #meteor-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white; border-radius: 50%;
            animation: twinkle var(--duration) infinite ease-in-out;
            opacity: var(--opacity);
        }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }

        /* --- LOGIC CHUY·ªÇN TRANG --- */
        .page {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; 
            justify-content: center; align-items: center;
            opacity: 0;
            z-index: 10;
            padding: 20px; /* Th√™m padding ƒë·ªÉ n·ªôi dung kh√¥ng s√°t l·ªÅ mobile */
        }
        .page.active { display: flex; opacity: 1; pointer-events: auto; }
        
        .page-exit {
            animation: pageZoomOut 0.8s forwards ease-in;
            pointer-events: none;
        }
        .page-enter {
            display: flex;
            animation: pageZoomIn 1s forwards ease-out;
            pointer-events: auto;
        }

        @keyframes pageZoomOut {
            0% { opacity: 1; transform: scale(1); filter: blur(0); }
            100% { opacity: 0; transform: scale(1.2); filter: blur(10px); }
        }
        @keyframes pageZoomIn {
            0% { opacity: 0; transform: scale(0.8); filter: blur(10px); }
            100% { opacity: 1; transform: scale(1); filter: blur(0); }
        }

        /* --- STYLE CHO N√öT B·∫§M (RESPONSIVE) --- */
        .btn-general {
            margin-top: 20px;
            padding: 12px 30px; /* TƒÉng v√πng b·∫•m cho c·∫£m ·ª©ng */
            background: transparent; color: #fff;
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: 30px; cursor: pointer;
            font-family: 'Dancing Script', cursive;
            font-size: clamp(1.2rem, 4vw, 1.5rem); /* T·ª± ƒë·ªông ch·ªânh size ch·ªØ n√∫t */
            transition: 0.3s;
            touch-action: manipulation; /* T·ªëi ∆∞u cho touch */
        }
        .btn-general:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); box-shadow: 0 0 15px rgba(255,255,255,0.3); }

        /* --- PAGE 1: NH·∫¨P T√äN --- */
        #page-1 input {
            background: transparent;
            border: none; border-bottom: 2px solid #fff;
            color: var(--text-gold); font-family: 'Dancing Script', cursive;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            text-align: center; outline: none; padding: 10px;
            width: 100%; max-width: 300px;
        }
        #page-1 h2 { 
            font-weight: normal; margin-bottom: 20px; 
            font-size: clamp(1rem, 4vw, 1.5rem); 
            opacity: 0.8; text-align: center;
        }

        /* --- PAGE 2: THI·ªÜP (B·ª®C TH∆Ø - RESPONSIVE) --- */
        .letter-container {
            background: var(--paper-bg);
            color: #2c3e50;
            padding: 40px 30px;
            border-radius: 2px;
            width: 100%;
            max-width: 550px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông tr√™n Desktop */
            /* X·ª≠ l√Ω chi·ªÅu cao tr√™n Mobile xoay ngang */
            max-height: 85vh; 
            overflow-y: auto; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 0 50px rgba(0,0,0,0.05);
            position: relative;
            transform: rotate(-1deg);
            animation: slideIn 1.2s ease-out forwards;
        }
        .letter-container::before {
            content: '';
            position: absolute;
            top: 0; right: 0;
            border-width: 0 40px 40px 0;
            border-style: solid;
            border-color: #ddd var(--bg-night) #ddd #ddd;
            display: block;
            width: 0;
        }
        .letter-container h1 {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            color: var(--accent-red);
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(138, 35, 35, 0.2);
            padding-bottom: 10px;
        }
        .letter-content {
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            line-height: 1.6;
            min-height: 150px;
            text-align: left;
            font-style: italic;
        }
        .letter-footer {
            margin-top: 20px;
            text-align: right;
            font-family: 'Dancing Script', cursive;
            font-size: clamp(1.1rem, 4vw, 1.3rem);
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(50px) rotate(-3deg); }
            to { opacity: 1; transform: translateY(0) rotate(-1deg); }
        }

        /* --- PAGE 3: CHOICE --- */
        .card {
            width: 90%;
            max-width: 600px;
            padding: 30px 20px !important; /* Ghi ƒë√® inline style */
        }
        .card h1 {
            font-size: clamp(2rem, 8vw, 3rem) !important;
        }
        .choice-btn-group { 
            display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;
        }

        /* --- PAGE 3: INTERACTIVE (SCROLLABLE) --- */
        #page-3-interactive {
            display: none;
            overflow-y: auto; /* Cho ph√©p cu·ªôn d·ªçc */
            overflow-x: hidden;
            background-color: var(--bg-night);
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20;
            -webkit-overflow-scrolling: touch; /* M∆∞·ª£t h∆°n tr√™n iOS */
        }
        .interactive-container {
            max-width: 700px;
            margin: 0 auto; 
            padding: 20px;
            position: relative; z-index: 100; padding-bottom: 100px;
        }
        .interactive-section {
            min-height: 90vh; /* M·ªói ph·∫ßn chi·∫øm g·∫ßn tr·ªçn m√†n h√¨nh */
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            opacity: 0; transform: translateY(20px);
            transition: opacity 1s, transform 1s;
            padding: 20px 0;
        }
        .interactive-section.visible { opacity: 1; transform: translateY(0); }
        
        .interactive-title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2rem, 6vw, 3rem); /* Responsive text */
            margin-bottom: 20px; color: var(--text-gold);
            text-shadow: 0 0 10px var(--fire-glow); text-align: center;
        }
        
        /* --- Element: N·ªìi B√°nh Ch∆∞ng --- */
        .pot-container { 
            position: relative;
            width: 120px; height: 100px; 
            background: #3e2723; border-radius: 10px 10px 40px 40px; 
            margin: 40px auto; /* Margin g·ªçn h∆°n */
            box-shadow: 0 0 50px var(--fire-glow);
            animation: flicker 3s infinite alternate; 
            transform-origin: center;
        }
        /* Mobile Scale cho n·ªìi */
        @media (max-width: 400px) {
            .pot-container { transform: scale(0.8); margin: 30px auto; }
        }
        
        .pot-lid { 
            width: 130px; height: 20px; background: #5d4037; 
            position: absolute; top: -10px; left: -5px; 
            border-radius: 5px; animation: rumble 0.5s infinite;
        }
        .steam { 
            position: absolute;
            top: -20px; left: 50%; 
            transform: translateX(-50%); 
            color: rgba(255,255,255,0.8); 
            font-family: 'Dancing Script', cursive;
            font-size: 1.2rem;
            white-space: nowrap;
            animation: steamUpNatural 4s ease-out forwards; 
            opacity: 0; pointer-events: none;
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
        }
        
        /* --- Element: ƒê√®n D·∫ßu --- */
        .lamp { 
            width: 40px; height: 60px; 
            background: rgba(255, 255, 255, 0.1); 
            border: 1px solid rgba(255,255,255,0.2); 
            border-radius: 50% 50% 10% 10%; 
            position: relative; margin: 20px auto; 
            display: flex; justify-content: center; overflow: hidden;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }
        .flame { 
            width: 14px; height: 30px; 
            background: linear-gradient(to top, orangered, orange, yellow);
            border-radius: 50% 50% 20% 20%; 
            position: absolute; bottom: 5px;
            box-shadow: 0 0 15px orange; opacity: 0.8; 
            animation: flickerSmall 0.2s infinite alternate; 
            transform-origin: bottom center; transition: all 0.5s;
        }
        .flame.flare-up { animation: flameBurst 2s forwards; }

        .wish-input-wrapper { position: relative; width: 90%; max-width: 400px; margin: 0 auto; height: 50px; }
        .wish-input, textarea { 
            width: 100%;
            background: transparent; border: none; border-bottom: 1px solid #777; 
            color: inherit; text-align: center; padding: 10px; 
            font-family: 'Dancing Script', cursive; font-size: 1.5rem;
            outline: none; display: block; 
        }
        textarea { font-family: 'Lora', serif; font-size: 1rem; width: 90%; max-width: 400px; resize: none; margin: 0 auto; display: block;}
        
        .ash-text {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            font-family: 'Dancing Script', cursive; font-size: 1.5rem;
            text-align: center; pointer-events: none; display: none;
            /* X·ª≠ l√Ω text d√†i tr√™n mobile */
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .turn-to-ash {
            animation: ashDissolve 3s forwards ease-in-out;
            display: block !important;
        }

        /* --- Element: C·ª≠a s·ªï (Responsive) --- */
        .window-frame { 
            /* Thay ƒë·ªïi width/height c·ªë ƒë·ªãnh th√†nh t∆∞∆°ng ƒë·ªëi */
            width: 80vw; 
            max-width: 300px; 
            height: 50vh; 
            max-height: 400px; 
            border: 8px solid #3e2723; 
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); 
            position: relative; overflow: hidden; border-radius: 4px;
            margin: 0 auto;
        }
        #window-meteor-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 5;
        }
        
        /* --- Element: L√¨ x√¨ --- */
        .envelope { 
            width: 120px; height: 180px; 
            background: var(--accent-red); margin: 30px auto; 
            position: relative; cursor: pointer; border-radius: 5px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); display: flex;
            justify-content: center; align-items: center; transition: transform 0.5s; 
        }
        .envelope::after { content: 'üßß'; font-size: 2rem; }
        .lucky-note { 
            display: none;
            background: #fff5e6; color: #8a2323; padding: 20px;
            border-radius: 5px; width: 90%; max-width: 400px; margin: 20px auto; 
            font-family: 'Dancing Script', cursive; font-size: 1.3rem;
            animation: unfold 1s ease; text-align: center;
        }

        /* --- KEYFRAMES --- */
        @keyframes steamUpNatural { 
            0% { top: -20px; opacity: 0; transform: translateX(-50%) scale(0.5); } 
            20% { opacity: 1; transform: translateX(-55%) scale(1); } 
            50% { transform: translateX(-45%) scale(1.1); }
            100% { top: -150px; opacity: 0; transform: translateX(-50%) scale(1.5); filter: blur(2px); } 
        }
        @keyframes flicker { 0% { opacity: 0.8; transform: scale(1); } 100% { opacity: 1; transform: scale(1.05); } }
        @keyframes flickerSmall { 0% { opacity: 0.7; transform: scale(0.8); } 100% { opacity: 0.9; transform: scale(0.9); } }
        @keyframes rumble { 0% { transform: rotate(0deg); } 25% { transform: rotate(1deg); } 75% { transform: rotate(-1deg); } }
        @keyframes unfold { from { transform: scaleY(0); } to { transform: scaleY(1); } }
        
        @keyframes flameBurst {
            0% { transform: scale(0.9); filter: brightness(1); }
            20% { transform: scale(1.6); filter: brightness(1.5); box-shadow: 0 0 60px orangered; }
            80% { transform: scale(1.4); filter: brightness(1.2); }
            100% { transform: scale(0.9); filter: brightness(1); }
        }

        @keyframes ashDissolve {
            0% { color: #fff; opacity: 1; transform: translateY(0) scale(1); }
            30% { color: #333; text-shadow: 0 0 15px orangered; transform: translateY(-20px) scale(1.1); } 
            60% { color: #888; text-shadow: none; filter: blur(4px); letter-spacing: 5px; opacity: 0.5; } 
            100% { color: transparent; transform: translateY(-150px) scale(1.5); filter: blur(15px); letter-spacing: 20px; opacity: 0; } 
        }

        /* --- PAGE 4: FINALE --- */
        #happy-new-year {
            position: absolute;
            top: 40%; left: 0; width: 100%;
            text-align: center; opacity: 0; pointer-events: none;
            transition: opacity 3s ease; z-index: 200;
            padding: 0 10px; /* Tr√°nh s√°t l·ªÅ mobile */
        }
        #happy-new-year h1 {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2.5rem, 8vw, 5rem); /* T·ª± ƒë·ªông ch·ªânh size ch·ªØ */
            color: #fff;
            text-shadow: 0 0 30px rgba(255,255,255,1), 0 0 60px #ffbd69;
            line-height: 1.2;
        }
        #happy-new-year p { 
            font-size: clamp(1rem, 4vw, 1.5rem); 
            margin-top: 10px; letter-spacing: 2px; 
            text-shadow: 0 0 10px rgba(255,255,255,0.5); 
        }
        
        #fireworksCanvas { display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* --- MEDIA QUERIES B·ªî SUNG CHO MOBILE NH·ªé --- */
        @media (max-width: 600px) {
            .letter-container { padding: 30px 20px; width: 95%; }
            /* ƒê·∫©y n√∫t xu·ªëng ch√∫t ƒë·ªÉ kh√¥ng b·ªã d√≠nh */
            .btn-general { margin-top: 25px; } 
        }
    </style>
</head>
<body>

    <div id="star-bg"></div>
    <canvas id="meteor-canvas"></canvas>

    <div id="page-1" class="page active">
        <h2>Ch√†o b·∫°n, t√™n b·∫°n l√† g√¨ n√®?</h2>
        <input type="text" id="name-input" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." autocomplete="off">
        <button class="btn-general" onclick="goToPage2()">Ti·∫øp t·ª•c</button>
    </div>

    <div id="page-2" class="page">
        <div class="letter-container">
            <h1>G·ª≠i <span id="display-name">...</span>,</h1>
            <div id="typewriter-text" class="letter-content"></div>
            <div class="letter-footer" id="letter-footer" style="opacity: 0; transition: 1s;">
                K√Ω t√™n: Tui n√® (G·ª≠i t·ª´ 2026)
            </div>
            <p id="wait-message" style="display:none; text-align: center; font-size: 0.9rem; margin-top: 25px; color: #888; font-style: italic; font-family: 'Lora', serif;">
                ƒê·ª£i 1 x√≠u nh√©...
            </p>
        </div>
        </div>

    <div id="page-3-choice" class="page">
        <div class="card" style="text-align: center; background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border-radius: 15px;">
            <h1 style="font-family: 'Dancing Script', cursive; color: var(--text-gold);">G·ª≠i G·∫Øm T∆∞∆°ng Lai</h1>
            <p style="margin: 20px 0; font-size: clamp(1rem, 3vw, 1.2rem);">B·∫°n c√≥ mong ∆∞·ªõc g√¨ g·ª≠i g·∫Øm cho ch√≠nh m√¨nh trong t∆∞∆°ng lai kh√¥ng?</p>
            <div class="choice-btn-group">
                <button class="btn-general" onclick="startInteractiveMode()">C√≥ ch·ª©</button>
                <button class="btn-general" onclick="goToPage4()">Kh√¥ng, ƒë·∫øn giao th·ª´a th√¥i</button>
            </div>
        </div>
    </div>

    <div id="page-3-interactive">
        <div class="interactive-container">
            <section class="interactive-section visible">
                <h2 class="interactive-title">B·∫øp l·ª≠a nƒÉm m·ªõi</h2>
                <div class="pot-container">
                    <div class="pot-lid"></div>
                    <div id="steam-container"></div>
                </div>
                <p style="text-align: center; color: #e6dace; padding: 0 10px;">B√™n n·ªìi b√°nh ch∆∞ng ƒëang s√¥i, nh·ªØng mong c·∫ßu ƒëang bay l√™n.</p>
                <div style="text-align: center; font-size: 1.5rem; margin-top: 20px;">‚¨á</div>
            </section>

            <section class="interactive-section">
                <h2 class="interactive-title">G·ª≠i L·∫°i NƒÉm C≈©</h2>
                <div class="lamp">
                    <div class="flame" id="lamp-flame"></div>
                </div>
                <div class="wish-input-wrapper">
                    <input type="text" class="wish-input" id="wish-input-old" placeholder="M·ªôt n·ªói bu·ªìn mu·ªën bu√¥ng b·ªè..." autocomplete="off">
                    <div id="ash-display" class="ash-text"></div>
                </div>
                <button class="btn-general" onclick="lightLamp()" style="display: block; margin: 20px auto;">Th·∫Øp ƒë√®n & H√≥a gi·∫£i</button>
                <div style="text-align: center; font-size: 1.5rem; margin-top: 20px;">‚¨á</div>
            </section>

            <section class="interactive-section">
                <h2 class="interactive-title">Khung C·ª≠a Nguy·ªán C·∫ßu</h2>
                <div class="window-frame" id="window-frame">
                    <div id="stars-layer-window" style="width:100%; height:100%;"></div>
                    <canvas id="window-meteor-canvas"></canvas> 
                </div>
                <textarea id="reflection-input" rows="1" placeholder="G·ª≠i v√†o ƒë√¢y m·ªôt hy v·ªçng..." style="margin-top:20px; color: #e6dace;"></textarea>
                <button class="btn-general" onclick="sendWish()" style="display: block; margin: 20px auto;">G·ª≠i ni·ªÅm hy v·ªçng</button>
                <p id="window-feedback" style="text-align:center; font-size: 0.8rem; margin-top: 10px; opacity: 0; transition: opacity 1s;">V≈© tr·ª• ƒë√£ l·∫Øng nghe.</p>
                <div style="text-align: center; font-size: 1.5rem; margin-top: 20px;">‚¨á</div>
            </section>

            <section class="interactive-section">
                <h2 class="interactive-title">L·ªôc ƒê·∫ßu NƒÉm</h2>
                <p style="text-align: center; color: #e6dace; padding: 0 10px;">Kh√¥ng ph·∫£i ti·ªÅn b·∫°c. ƒê√¢y l√† ch√∫t v·ªën li·∫øng tinh th·∫ßn cho b·∫°n.</p>
                <div class="envelope" onclick="openEnvelope()"></div>
                <div id="lucky-note" class="lucky-note"></div>
                <div style="text-align: center; font-size: 1.5rem; margin-top: 20px;">‚¨á</div>
            </section>

            <section class="interactive-section">
                <h2 class="interactive-title">C√πng nhau ng·∫Øm ph√°o hoa nh√©</h2>
                <p style="text-align: center; color: #e6dace; padding: 0 10px;">Th·ªùi kh·∫Øc r·ª±c r·ª° nh·∫•t ƒë√£ ƒë·∫øn r·ªìi.</p>
                <button class="btn-general" onclick="goToPage4()">B·∫Øt ƒë·∫ßu th√¥i n√†o</button>
            </section>
        </div>
    </div>

    <div id="page-4" class="page">
        <canvas id="fireworksCanvas"></canvas>
        <div id="happy-new-year">
            <h1>Happy New Year 2026</h1>
            <p>R·ª±c r·ª° - B√¨nh An - H·∫°nh Ph√∫c</p>
        </div>
    </div>

    <script>
        // --- 1. SETUP CHUNG ---
        function createStars() {
            const bg = document.getElementById('star-bg');
            for(let i=0; i<100; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                const size = Math.random() * 2 + 1;
                s.style.width = size + 'px'; s.style.height = size + 'px';
                s.style.left = Math.random() * 100 + '%';
                s.style.top = Math.random() * 100 + '%';
                s.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
                s.style.setProperty('--opacity', Math.random());
                bg.appendChild(s);
            }
        }
        createStars();

        // --- ENGINE SAO BƒÇNG ---
        class MeteorEngine {
            constructor(canvasId, isWindow = false) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.meteors = [];
                this.width = 0;
                this.height = 0;
                this.isWindow = isWindow;
                this.resize();
                if(!isWindow) {
                    window.addEventListener('resize', () => this.resize());
                } else {
                    // Update: Listen to window resize for window frame too
                    window.addEventListener('resize', () => this.resizeWindowFrame());
                    this.resizeWindowFrame();
                }
                this.animate();
            }

            resize() {
                this.width = window.innerWidth;
                this.height = window.innerHeight;
                this.canvas.width = this.width;
                this.canvas.height = this.height;
            }

            resizeWindowFrame() {
                // Ensure canvas matches the responsive div size
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.width = rect.width;
                this.height = rect.height;
                this.canvas.width = this.width;
                this.canvas.height = this.height;
            }

            shoot(forced = false) {
                let chance = this.isWindow ? 0.01 : 0.02; 
                if (!forced && Math.random() > chance) return;
                this.meteors.push(new Meteor(this.width, this.height, this.isWindow));
            }

            animate() {
                this.ctx.clearRect(0, 0, this.width, this.height);
                this.shoot();

                for (let i = 0; i < this.meteors.length; i++) {
                    this.meteors[i].update();
                    this.meteors[i].draw(this.ctx);
                    
                    if (this.meteors[i].isDead()) {
                        this.meteors.splice(i, 1);
                        i--;
                    }
                }
                requestAnimationFrame(() => this.animate());
            }
        }

        class Meteor {
            constructor(w, h, isWindow) {
                this.isWindow = isWindow;
                if(isWindow) {
                    this.x = Math.random() * w;
                    this.y = Math.random() * (h * 0.4); 
                    this.len = Math.random() * 40 + 30;
                    this.speed = Math.random() * 2 + 5;
                    this.size = Math.random() + 0.5;
                } else {
                    this.x = Math.random() * w;
                    this.y = Math.random() * h * 0.5; 
                    this.len = Math.random() * 200 + 100;
                    this.speed = Math.random() * 10 + 20;
                    this.size = Math.random() * 2 + 0.5;
                }
                
                this.angle = Math.PI / 4 + (Math.random() * 0.2 - 0.1);
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.opacity = 1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.opacity -= 0.015;
            }

            draw(ctx) {
                const tailX = this.x - Math.cos(this.angle) * this.len;
                const tailY = this.y - Math.sin(this.angle) * this.len;

                const gradient = ctx.createLinearGradient(this.x, this.y, tailX, tailY);
                gradient.addColorStop(0, `rgba(255, 255, 255, ${this.opacity})`);
                gradient.addColorStop(1, `rgba(255, 255, 255, 0)`);

                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(tailX, tailY);
                ctx.lineWidth = this.size;
                ctx.lineCap = 'round';
                ctx.strokeStyle = gradient;
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.shadowBlur = 5;
                ctx.shadowColor = "white";
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            isDead() {
                return this.opacity <= 0;
            }
        }

        const bgMeteorEngine = new MeteorEngine('meteor-canvas');

        // --- 2. LOGIC CHUY·ªÇN TRANG & B·ª®C TH∆Ø ---
        
        const wishesList = [
            "NƒÉm 2026 ƒë√£ ƒë·∫øn r·ªìi, mong r·∫±ng m·ªói s√°ng th·ª©c d·∫≠y b·∫°n ƒë·ªÅu c·∫£m th·∫•y tr√†n ƒë·∫ßy nƒÉng l∆∞·ª£ng v√† ni·ªÅm vui. Ch√∫c b·∫°n c√≥ ƒë·ªß s·ª©c kh·ªèe ƒë·ªÉ theo ƒëu·ªïi ƒëam m√™, ƒë·ªß ki√™n nh·∫´n ƒë·ªÉ v∆∞·ª£t qua th·ª≠ th√°ch v√† ƒë·ªß y√™u th∆∞∆°ng ƒë·ªÉ s∆∞·ªüi ·∫•m t√¢m h·ªìn nh·ªØng ng∆∞·ªùi xung quanh.",
            "Ch√†o nƒÉm m·ªõi v·ªõi th·∫≠t nhi·ªÅu hy v·ªçng! Ch√∫c b·∫°n lu√¥n gi·ªØ v·ªØng ni·ªÅm tin v√†o b·∫£n th√¢n, b·ªüi v√¨ b·∫°n x·ª©ng ƒë√°ng v·ªõi m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t. H√£y ƒë·ªÉ nƒÉm 2026 l√† m·ªôt ch∆∞∆°ng s√°ch r·ª±c r·ª°, n∆°i b·∫°n vi·∫øt n√™n nh·ªØng th√†nh c√¥ng vang d·ªôi v√† nh·ªØng k·ª∑ ni·ªám ƒë√°ng nh·ªõ.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm m·ªõi b√¨nh an t·ª´ trong t√¢m tr√≠ ƒë·∫øn cu·ªôc s·ªëng b√™n ngo√†i. Mong r·∫±ng m·ªçi lo toan c·ªßa nƒÉm c≈© s·∫Ω tan bi·∫øn, nh∆∞·ªùng ch·ªó cho nh·ªØng c∆° h·ªôi m·ªõi, nh·ªØng ng∆∞·ªùi b·∫°n m·ªõi v√† nh·ªØng ni·ªÅm vui b·∫•t ng·ªù ƒëang ch·ªù ƒë·ª£i b·∫°n ·ªü ph√≠a tr∆∞·ªõc.",
            "NƒÉm m·ªõi 2026, ch√∫c b·∫°n ch√¢n c·ª©ng ƒë√° m·ªÅm tr√™n m·ªçi n·∫ªo ƒë∆∞·ªùng. D√π cu·ªôc s·ªëng c√≥ ƒë√¥i l√∫c ch√¥ng gai, h√£y nh·ªõ r·∫±ng sau c∆°n m∆∞a tr·ªùi l·∫°i s√°ng. Mong b·∫°n lu√¥n t√¨m th·∫•y √°nh s√°ng d·∫´n l·ªëi v√† g·∫∑t h√°i ƒë∆∞·ª£c nh·ªØng th√†nh qu·∫£ ng·ªçt ng√†o x·ª©ng ƒë√°ng v·ªõi n·ªó l·ª±c c·ªßa m√¨nh.",
            "M·ªôt nƒÉm m·ªõi l·∫°i ƒë·∫øn, ch√∫c b·∫°n c√≥ th√™m nhi·ªÅu th·ªùi gian √Ω nghƒ©a b√™n gia ƒë√¨nh v√† nh·ªØng ng∆∞·ªùi th√¢n y√™u. Ti·ªÅn b·∫°c c√≥ th·ªÉ ki·∫øm l·∫°i ƒë∆∞·ª£c, nh∆∞ng kho·∫£nh kh·∫Øc sum v·∫ßy l√† v√¥ gi√°. H√£y tr√¢n tr·ªçng t·ª´ng ph√∫t gi√¢y h·∫°nh ph√∫c v√† l·∫•p ƒë·∫ßy nƒÉm 2026 b·∫±ng ti·∫øng c∆∞·ªùi.",
            "Ch√∫c b·∫°n nƒÉm 2026 s·ª± nghi·ªáp thƒÉng hoa, t√†i l·ªôc d·ªìi d√†o nh∆∞ng quan tr·ªçng nh·∫•t v·∫´n l√† s·ª©c kh·ªèe d·∫ªo dai. ƒê·ª´ng qu√™n chƒÉm s√≥c b·∫£n th√¢n gi·ªØa gu·ªìng quay c√¥ng vi·ªác, b·ªüi v√¨ s·ª©c kh·ªèe ch√≠nh l√† n·ªÅn t·∫£ng v·ªØng ch·∫Øc nh·∫•t ƒë·ªÉ b·∫°n chinh ph·ª•c m·ªçi ƒë·ªânh cao m∆° ∆∞·ªõc.",
            "G·ª≠i ƒë·∫øn b·∫°n l·ªùi ch√∫c nƒÉm m·ªõi tr√†n ng·∫≠p t√¨nh y√™u th∆∞∆°ng v√† s·ª± ·∫•m √°p. Mong r·∫±ng nƒÉm nay b·∫°n s·∫Ω t√¨m th·∫•y m·ªôt n·ª≠a y√™u th∆∞∆°ng ho·∫∑c vun ƒë·∫Øp h·∫°nh ph√∫c hi·ªán t·∫°i th√™m b·ªÅn ch·∫∑t. Ch√∫c tr√°i tim b·∫°n lu√¥n ƒë∆∞·ª£c s∆∞·ªüi ·∫•m b·ªüi nh·ªØng rung ƒë·ªông ng·ªçt ng√†o nh·∫•t.",
            "NƒÉm m·ªõi 2026, ch√∫c b·∫°n lu√¥n gi·ªØ ƒë∆∞·ª£c s·ª± t√≤ m√≤ v√† khao kh√°t kh√°m ph√° th·∫ø gi·ªõi. H√£y ƒëi ƒë·∫øn nh·ªØng v√πng ƒë·∫•t m·ªõi, h·ªçc h·ªèi nh·ªØng ƒëi·ªÅu m·ªõi l·∫° v√† m·ªü r·ªông t·∫ßm m·∫Øt. Cu·ªôc ƒë·ªùi l√† nh·ªØng chuy·∫øn ƒëi, v√† mong h√†nh tr√¨nh nƒÉm nay c·ªßa b·∫°n s·∫Ω th·∫≠t tuy·ªát v·ªùi.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm m·ªõi t√¢m b·∫•t bi·∫øn gi·ªØa d√≤ng ƒë·ªùi v·∫°n bi·∫øn. D√π th·∫ø gi·ªõi b√™n ngo√†i c√≥ ·ªìn √†o ƒë·∫øn ƒë√¢u, mong b·∫°n v·∫´n gi·ªØ ƒë∆∞·ª£c s·ª± tƒ©nh l·∫∑ng v√† an y√™n trong t√¢m h·ªìn. H√£y s·ªëng ch·∫≠m l·∫°i m·ªôt ch√∫t ƒë·ªÉ c·∫£m nh·∫≠n tr·ªçn v·∫πn v·∫ª ƒë·∫πp c·ªßa cu·ªôc s·ªëng n√†y.",
            "NƒÉm 2026, ch√∫c b·∫°n d√°m nghƒ© d√°m l√†m, bi·∫øn nh·ªØng ∆∞·ªõc m∆° ·∫•p ·ªß b·∫•y l√¢u th√†nh hi·ªán th·ª±c. ƒê·ª´ng s·ª£ th·∫•t b·∫°i, b·ªüi m·ªói v·∫•p ng√£ l√† m·ªôt b√†i h·ªçc qu√Ω gi√°. H√£y m·∫°nh m·∫Ω b∆∞·ªõc ra kh·ªèi v√πng an to√†n v√† t·ªèa s√°ng theo c√°ch ri√™ng c·ªßa ch√≠nh b·∫°n nh√©.",
            "Ch√∫c b·∫°n nƒÉm m·ªõi ti·ªÅn v√†o nh∆∞ n∆∞·ªõc, nh∆∞ng ni·ªÅm vui v√† h·∫°nh ph√∫c c√≤n nhi·ªÅu h∆°n th·∫ø. Mong r·∫±ng m·ªói ng√†y tr√¥i qua ƒë·ªÅu mang ƒë·∫øn cho b·∫°n m·ªôt l√Ω do ƒë·ªÉ m·ªâm c∆∞·ªùi. H√£y s·ªëng h·∫øt m√¨nh, y√™u th∆∞∆°ng h·∫øt l√≤ng v√† t·∫≠n h∆∞·ªüng tr·ªçn v·∫πn t·ª´ng kho·∫£nh kh·∫Øc c·ªßa nƒÉm 2026.",
            "NƒÉm m·ªõi ch√∫c b·∫°n lu√¥n ƒë∆∞·ª£c bao quanh b·ªüi nh·ªØng ng∆∞·ªùi b·∫°n ch√¢n th√†nh v√† t·ªët b·ª•ng. Mong r·∫±ng nh·ªØng m·ªëi quan h·ªá c·ªßa b·∫°n s·∫Ω ng√†y c√†ng b·ªÅn ch·∫∑t v√† mang l·∫°i nhi·ªÅu gi√° tr·ªã t√≠ch c·ª±c. H√£y c√πng nhau chia s·∫ª ni·ªÅm vui, n·ªói bu·ªìn v√† c√πng nhau ti·∫øn v·ªÅ ph√≠a tr∆∞·ªõc.",
            "Ch√∫c b·∫°n nƒÉm 2026 kh√¥ng c√≤n mu·ªôn phi·ªÅn, ch·ªâ to√†n l√† nh·ªØng ƒëi·ªÅu may m·∫Øn v√† thu·∫≠n l·ª£i. M·ªçi d·ª± ƒë·ªãnh b·∫°n ƒë·∫∑t ra ƒë·ªÅu s·∫Ω th√†nh c√¥ng r·ª±c r·ª°. H√£y tin r·∫±ng v≈© tr·ª• lu√¥n l·∫Øng nghe nh·ªØng khao kh√°t c·ªßa b·∫°n v√† s·∫Ω mang ƒë·∫øn nh·ªØng ƒëi·ªÅu k·ª≥ di·ªáu ƒë√∫ng l√∫c nh·∫•t.",
            "Ch√†o 2026, ch√∫c b·∫°n c√≥ m·ªôt t√¢m h·ªìn r·ªông m·ªü ƒë·ªÉ ƒë√≥n nh·∫≠n m·ªçi ƒëi·ªÅu hay l·∫Ω ph·∫£i. H√£y tha th·ª© cho nh·ªØng l·ªói l·∫ßm c≈©, bu√¥ng b·ªè nh·ªØng g√°nh n·∫∑ng kh√¥ng c·∫ßn thi·∫øt v√† b∆∞·ªõc v√†o nƒÉm m·ªõi v·ªõi m·ªôt tr√°i tim nh·∫π nh√†ng, thanh th·∫£n v√† tr√†n ƒë·∫ßy t√¨nh y√™u th∆∞∆°ng.",
            "NƒÉm m·ªõi ch√∫c b·∫°n lu√¥n xinh ƒë·∫πp, r·∫°ng r·ª° v√† t·ª± tin v√†o ch√≠nh m√¨nh. V·∫ª ƒë·∫πp th·ª±c s·ª± to√°t ra t·ª´ s·ª± t·ª≠ t·∫ø v√† tr√≠ tu·ªá b√™n trong. H√£y c·ª© l√† ch√≠nh m√¨nh, t·ªèa s√°ng theo c√°ch ƒë·ªôc ƒë√°o nh·∫•t v√† khi·∫øn th·∫ø gi·ªõi n√†y tr·ªü n√™n t∆∞∆°i ƒë·∫πp h∆°n v√¨ c√≥ b·∫°n.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm 2026 c√¥ng vi·ªác thu·∫≠n bu·ªìm xu√¥i gi√≥, l√†m ƒë√¢u th·∫Øng ƒë√≥. Mong r·∫±ng nh·ªØng n·ªó l·ª±c kh√¥ng ng·ª´ng ngh·ªâ c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c ƒë·ªÅn ƒë√°p x·ª©ng ƒë√°ng b·∫±ng nh·ªØng th√†nh t·ª±u v∆∞·ª£t b·∫≠c. H√£y gi·ªØ v·ªØng ng·ªçn l·ª≠a ƒëam m√™ v√† ti·∫øp t·ª•c chinh ph·ª•c nh·ªØng ƒë·ªânh cao m·ªõi.",
            "NƒÉm m·ªõi ƒë·∫øn r·ªìi, ch√∫c b·∫°n c√≥ nh·ªØng gi·∫•c ng·ªß ngon, nh·ªØng b·ªØa ƒÉn ·∫•p c√∫ng v√† nh·ªØng ng√†y ngh·ªâ th·∫£nh th∆°i. Cu·ªôc s·ªëng kh√¥ng ch·ªâ l√† c√¥ng vi·ªác, h√£y d√†nh th·ªùi gian ƒë·ªÉ nu√¥ng chi·ªÅu b·∫£n th√¢n v√† t·∫≠n h∆∞·ªüng nh·ªØng ni·ªÅm vui gi·∫£n d·ªã nh∆∞ng v√¥ c√πng qu√Ω gi√° m·ªói ng√†y.",
            "Ch√∫c b·∫°n nƒÉm 2026 t√¨m th·∫•y s·ª± c√¢n b·∫±ng ho√†n h·∫£o gi·ªØa c√¥ng vi·ªác v√† cu·ªôc s·ªëng. ƒê·ª´ng ƒë·ªÉ √°p l·ª±c cu·ªën b·∫°n ƒëi qu√° xa, h√£y bi·∫øt d·ª´ng l·∫°i ƒë√∫ng l√∫c ƒë·ªÉ t√°i t·∫°o nƒÉng l∆∞·ª£ng. Mong b·∫°n lu√¥n t√¨m th·∫•y ni·ªÅm vui trong t·ª´ng vi·ªác m√¨nh l√†m v√† s·ªëng th·∫≠t tr·ªçn v·∫πn.",
            "G·ª≠i b·∫°n l·ªùi ch√∫c nƒÉm m·ªõi v·∫°n s·ª± nh∆∞ √Ω, t·ª∑ s·ª± nh∆∞ m∆°. Mong r·∫±ng th·∫ßn may m·∫Øn s·∫Ω lu√¥n g√µ c·ª≠a nh√† b·∫°n, mang ƒë·∫øn t√†i l·ªôc, s·ª©c kh·ªèe v√† h·∫°nh ph√∫c. H√£y m·ªü r·ªông v√≤ng tay ƒë√≥n nh·∫≠n nh·ªØng ƒëi·ªÅu tuy·ªát v·ªùi m√† nƒÉm 2026 ƒëang mang ƒë·∫øn cho b·∫°n.",
            "NƒÉm m·ªõi ch√∫c b·∫°n lu√¥n gi·ªØ ƒë∆∞·ª£c s·ª± l·∫°c quan v√† n·ª• c∆∞·ªùi tr√™n m√¥i. D√π cu·ªôc ƒë·ªùi c√≥ n√©m cho b·∫°n ƒëi·ªÅu g√¨, h√£y ƒë√≥n nh·∫≠n n√≥ v·ªõi th√°i ƒë·ªô t√≠ch c·ª±c nh·∫•t. NƒÉng l∆∞·ª£ng vui v·∫ª c·ªßa b·∫°n s·∫Ω l√† ch√¨a kh√≥a m·ªü ra m·ªçi c√°nh c·ª≠a th√†nh c√¥ng v√† h·∫°nh ph√∫c.",
            "Ch√∫c b·∫°n nƒÉm 2026 h·ªçc ƒë∆∞·ª£c c√°ch y√™u th∆∞∆°ng b·∫£n th√¢n nhi·ªÅu h∆°n. H√£y l·∫Øng nghe c∆° th·ªÉ, chƒÉm s√≥c t√¢m tr√≠ v√† ƒë·ª´ng bao gi·ªù ƒë·ªÉ ai l√†m t·ªïn th∆∞∆°ng gi√° tr·ªã c·ªßa b·∫°n. B·∫°n l√† phi√™n b·∫£n duy nh·∫•t v√† tuy·ªát v·ªùi nh·∫•t, h√£y lu√¥n nh·ªõ k·ªπ ƒëi·ªÅu ƒë√≥ nh√©.",
            "NƒÉm m·ªõi, ch√∫c b·∫°n c√≥ ƒë·ªß d≈©ng kh√≠ ƒë·ªÉ t·ª´ b·ªè nh·ªØng th√≥i quen x·∫•u v√† x√¢y d·ª±ng nh·ªØng th√≥i quen t·ªët. S·ª± thay ƒë·ªïi nh·ªè m·ªói ng√†y s·∫Ω t·∫°o n√™n th√†nh c√¥ng l·ªõn trong t∆∞∆°ng lai. H√£y ki√™n tr√¨ v√† tin t∆∞·ªüng v√†o qu√° tr√¨nh ho√†n thi·ªán b·∫£n th√¢n c·ªßa m√¨nh trong nƒÉm nay.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm 2026 ƒë·∫ßy ·∫Øp nh·ªØng tr·∫£i nghi·ªám th√∫ v·ªã v√† nh·ªØng b√†i h·ªçc s√¢u s·∫Øc. Mong r·∫±ng m·ªói kh√≥ khƒÉn ƒëi qua s·∫Ω ƒë·ªÉ l·∫°i cho b·∫°n s·ª± tr∆∞·ªüng th√†nh v√† b·∫£n lƒ©nh. H√£y s·ªëng nh∆∞ m·ªôt ƒë√≥a hoa, v∆∞∆°n m√¨nh ƒë√≥n n·∫Øng v√† t·ªèa ng√°t h∆∞∆°ng th∆°m cho ƒë·ªùi.",
            "NƒÉm m·ªõi ch√∫c b·∫°n gia ƒë√¨nh h√≤a thu·∫≠n, anh em sum v·∫ßy, cha m·∫π s·ªëng l√¢u trƒÉm tu·ªïi. Gia ƒë√¨nh l√† ƒëi·ªÉm t·ª±a v·ªØng ch·∫Øc nh·∫•t, h√£y d√†nh nhi·ªÅu th·ªùi gian h∆°n ƒë·ªÉ quan t√¢m v√† chƒÉm s√≥c nh·ªØng ng∆∞·ªùi th√¢n y√™u. Ch√∫c t·ªï ·∫•m c·ªßa b·∫°n lu√¥n tr√†n ng·∫≠p ti·∫øng c∆∞·ªùi v√† h·∫°nh ph√∫c.",
            "Ch√∫c b·∫°n nƒÉm 2026 t√†i ch√≠nh v·ªØng v√†ng, ƒë·∫ßu t∆∞ ƒë√¢u th·∫Øng ƒë√≥. Mong r·∫±ng t√∫i ti·ªÅn c·ªßa b·∫°n l√∫c n√†o c≈©ng r·ªßng r·ªânh ƒë·ªÉ b·∫°n c√≥ th·ªÉ th·ª±c hi·ªán m·ªçi d·ª± ƒë·ªãnh v√† chƒÉm lo t·ªët cho cu·ªôc s·ªëng. Nh∆∞ng ƒë·ª´ng qu√™n, ti·ªÅn b·∫°c l√† ph∆∞∆°ng ti·ªán, h·∫°nh ph√∫c m·ªõi l√† ƒë√≠ch ƒë·∫øn.",
            "NƒÉm m·ªõi ch√∫c b·∫°n t√¨m th·∫•y ni·ªÅm ƒëam m√™ ƒë√≠ch th·ª±c c·ªßa cu·ªôc ƒë·ªùi m√¨nh n·∫øu b·∫°n ch∆∞a t√¨m th·∫•y. V√† n·∫øu ƒë√£ t√¨m th·∫•y, ch√∫c b·∫°n ch√°y h·∫øt m√¨nh v·ªõi n√≥. S·ªëng v·ªõi ƒëam m√™ l√† c√°ch tuy·ªát v·ªùi nh·∫•t ƒë·ªÉ m·ªói ng√†y tr√¥i qua ƒë·ªÅu tr·ªü n√™n √Ω nghƒ©a v√† ƒë√°ng nh·ªõ.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm 2026 th·∫≠t nhi·ªÅu s·ª©c kh·ªèe ƒë·ªÉ ƒëi ƒë·∫øn nh·ªØng n∆°i m√¨nh mu·ªën, ƒÉn nh·ªØng m√≥n m√¨nh th√≠ch v√† l√†m nh·ªØng ƒëi·ªÅu m√¨nh y√™u. S·ª©c kh·ªèe l√† v√†ng, h√£y tr√¢n tr·ªçng v√† b·∫£o v·ªá n√≥ m·ªói ng√†y. Mong b·∫°n lu√¥n d·∫ªo dai v√† tr√†n ƒë·∫ßy s·ª©c s·ªëng thanh xu√¢n.",
            "Ch√†o nƒÉm m·ªõi, ch√∫c b·∫°n c√≥ m·ªôt t√¢m tr√≠ minh m·∫´n v√† s√°ng su·ªët ƒë·ªÉ ƒë∆∞a ra nh·ªØng quy·∫øt ƒë·ªãnh ƒë√∫ng ƒë·∫Øn. Mong r·∫±ng m·ªçi l·ª±a ch·ªçn c·ªßa b·∫°n trong nƒÉm 2026 ƒë·ªÅu d·∫´n ƒë·∫øn nh·ªØng k·∫øt qu·∫£ t·ªët ƒë·∫πp. H√£y tin v√†o tr·ª±c gi√°c v√† tr√≠ tu·ªá c·ªßa b·∫£n th√¢n m√¨nh nh√©.",
            "NƒÉm m·ªõi ch√∫c b·∫°n lu√¥n ƒë∆∞·ª£c v√¢y quanh b·ªüi nh·ªØng ngu·ªìn nƒÉng l∆∞·ª£ng t√≠ch c·ª±c. H√£y tr√°nh xa nh·ªØng th·ªã phi, nh·ªØng ƒëi·ªÅu ti√™u c·ª±c l√†m ·∫£nh h∆∞·ªüng ƒë·∫øn t√¢m tr·∫°ng c·ªßa b·∫°n. Ch√∫c cu·ªôc s·ªëng c·ªßa b·∫°n trong nƒÉm 2026 s·∫Ω trong tr·∫ªo, nh·∫π nh√†ng v√† b√¨nh y√™n nh∆∞ m·ªôt d√≤ng s√¥ng √™m ƒë·ªÅm.",
            "Ch√∫c b·∫°n nƒÉm 2026 g·∫∑t h√°i ƒë∆∞·ª£c nhi·ªÅu th√†nh c√¥ng kh√¥ng ch·ªâ trong s·ª± nghi·ªáp m√† c√≤n trong vi·ªác ph√°t tri·ªÉn b·∫£n th√¢n. Mong b·∫°n ng√†y c√†ng ho√†n thi·ªán, tr·ªü th√†nh phi√™n b·∫£n t·ªët h∆°n c·ªßa ch√≠nh m√¨nh ng√†y h√¥m qua. S·ª± ti·∫øn b·ªô c·ªßa b·∫°n l√† ƒëi·ªÅu ƒë√°ng t·ª± h√†o nh·∫•t.",
            "NƒÉm m·ªõi ch√∫c b·∫°n c√≥ nh·ªØng ng∆∞·ªùi th·∫ßy gi·ªèi d·∫´n d·∫Øt, nh·ªØng ng∆∞·ªùi b·∫°n hi·ªÅn ƒë·ªìng h√†nh v√† nh·ªØng c·ªông s·ª± ƒë·∫Øc l·ª±c h·ªó tr·ª£. Th√†nh c√¥ng kh√¥ng bao gi·ªù ƒë·∫øn t·ª´ s·ª± ƒë∆°n ƒë·ªôc, mong b·∫°n lu√¥n c√≥ nh·ªØng ng∆∞·ªùi tuy·ªát v·ªùi b√™n c·∫°nh ƒë·ªÉ c√πng nhau chia s·∫ª v√† v∆∞∆°n t·ªõi vinh quang.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm 2026 tr√†n ƒë·∫ßy c·∫£m h·ª©ng s√°ng t·∫°o. Mong r·∫±ng nh·ªØng √Ω t∆∞·ªüng m·ªõi m·∫ª s·∫Ω li√™n t·ª•c n·∫£y sinh trong t√¢m tr√≠ b·∫°n, gi√∫p b·∫°n gi·∫£i quy·∫øt m·ªçi v·∫•n ƒë·ªÅ m·ªôt c√°ch ƒë·ªôc ƒë√°o v√† hi·ªáu qu·∫£. H√£y ƒë·ªÉ tr√≠ t∆∞·ªüng t∆∞·ª£ng c·ªßa b·∫°n bay cao v√† bay xa h∆°n n·ªØa.",
            "NƒÉm m·ªõi ch√∫c b·∫°n bi·∫øt c√°ch bu√¥ng b·ªè nh·ªØng g√¨ kh√¥ng c√≤n thu·ªôc v·ªÅ m√¨nh ƒë·ªÉ ƒë√¥i tay th·∫£nh th∆°i ƒë√≥n nh·∫≠n nh·ªØng ƒëi·ªÅu m·ªõi m·∫ª. ƒê√¥i khi, h·∫°nh ph√∫c kh√¥ng ph·∫£i l√† n·∫Øm gi·ªØ m√† l√† bi·∫øt bu√¥ng tay ƒë√∫ng l√∫c. Ch√∫c b·∫°n c√≥ m·ªôt nƒÉm 2026 nh·∫π nh√µm v√† t·ª± do t·ª± t·∫°i.",
            "Ch√∫c b·∫°n nƒÉm 2026 lu√¥n gi·ªØ ƒë∆∞·ª£c s·ª± t·ª≠ t·∫ø v√† l√≤ng tr·∫Øc ·∫©n. Trong m·ªôt th·∫ø gi·ªõi ƒë·∫ßy bi·∫øn ƒë·ªông, l√≤ng t·ªët c·ªßa b·∫°n ch√≠nh l√† ng·ªçn h·∫£i ƒëƒÉng soi s√°ng cho nhi·ªÅu ng∆∞·ªùi. H√£y c·ª© cho ƒëi y√™u th∆∞∆°ng, v√† cu·ªôc ƒë·ªùi s·∫Ω tr·∫£ l·∫°i cho b·∫°n mu√¥n v√†n ph∆∞·ªõc l√†nh.",
            "NƒÉm m·ªõi ch√∫c b·∫°n c√≥ ƒë·ªß b·∫£n lƒ©nh ƒë·ªÉ n√≥i 'kh√¥ng' v·ªõi nh·ªØng ƒëi·ªÅu kh√¥ng ph√π h·ª£p v√† n√≥i 'c√≥' v·ªõi nh·ªØng c∆° h·ªôi tuy·ªát v·ªùi. Mong b·∫°n lu√¥n s·ªëng th·∫≠t v·ªõi c·∫£m x√∫c c·ªßa m√¨nh, kh√¥ng ph·∫£i g∆∞·ª£ng √©p hay l√†m h√†i l√≤ng ng∆∞·ªùi kh√°c. H√£y s·ªëng cu·ªôc ƒë·ªùi c·ªßa ch√≠nh b·∫°n.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm 2026 r·ª±c r·ª° s·∫Øc m√†u, m·ªói ng√†y l√† m·ªôt b·ª©c tranh tuy·ªát ƒë·∫πp do ch√≠nh tay b·∫°n v·∫Ω n√™n. H√£y t√¥ ƒëi·ªÉm cu·ªôc s·ªëng b·∫±ng nh·ªØng ni·ªÅm vui, nh·ªØng s·ªü th√≠ch c√° nh√¢n v√† nh·ªØng kho·∫£nh kh·∫Øc ng·∫´u h·ª©ng. ƒê·ª´ng ƒë·ªÉ cu·ªôc s·ªëng c·ªßa b·∫°n tr√¥i qua m·ªôt c√°ch t·∫ª nh·∫°t.",
            "NƒÉm m·ªõi ch√∫c b·∫°n lu√¥n t√¨m th·∫•y √°nh s√°ng ngay c·∫£ trong nh·ªØng ng√†y u t·ªëi nh·∫•t. Hy v·ªçng l√† th·ª© kh√¥ng bao gi·ªù ƒë∆∞·ª£c ph√©p t·∫Øt. Mong b·∫°n lu√¥n gi·ªØ v·ªØng ni·ªÅm tin r·∫±ng ng√†y mai tr·ªùi l·∫°i s√°ng v√† m·ªçi chuy·ªán r·ªìi s·∫Ω ·ªïn th√¥i. Ch√∫c b·∫°n m·ªôt nƒÉm ki√™n c∆∞·ªùng.",
            "Ch√∫c b·∫°n nƒÉm 2026 k·∫øt n·ªëi ƒë∆∞·ª£c v·ªõi nhi·ªÅu t√¢m h·ªìn ƒë·ªìng ƒëi·ªáu. Mong b·∫°n s·∫Ω kh√¥ng bao gi·ªù c·∫£m th·∫•y c√¥ ƒë∆°n tr√™n h√†nh tr√¨nh c·ªßa m√¨nh. Nh·ªØng cu·ªôc g·∫∑p g·ª° ƒë·ªãnh m·ªánh s·∫Ω mang ƒë·∫øn cho b·∫°n nh·ªØng b√†i h·ªçc qu√Ω gi√° v√† nh·ªØng t√¨nh b·∫°n ƒë·∫πp ƒë·∫Ω theo b·∫°n su·ªët ƒë·ªùi.",
            "NƒÉm m·ªõi ch√∫c b·∫°n c√≥ nh·ªØng gi·∫•c m∆° th·∫≠t ƒë·∫πp v√† bi·∫øn ch√∫ng th√†nh hi·ªán th·ª±c ngay khi th·ª©c gi·∫•c. ƒê·ª´ng ƒë·ªÉ ∆∞·ªõc m∆° ch·ªâ m√£i l√† m∆° ∆∞·ªõc, h√£y b·∫Øt tay v√†o h√†nh ƒë·ªông ngay h√¥m nay. NƒÉm 2026 s·∫Ω l√† nƒÉm c·ªßa h√†nh ƒë·ªông v√† k·∫øt qu·∫£, ch√∫c b·∫°n th√†nh c√¥ng m·ªπ m√£n.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm 2026 ng·∫≠p tr√†n l√≤ng bi·∫øt ∆°n. Bi·∫øt ∆°n nh·ªØng g√¨ m√¨nh ƒëang c√≥ l√† c√°ch nhanh nh·∫•t ƒë·ªÉ c·∫£m th·∫•y h·∫°nh ph√∫c. Mong b·∫°n lu√¥n tr√¢n tr·ªçng t·ª´ng b·ªØa ƒÉn, t·ª´ng gi·∫•c ng·ªß v√† t·ª´ng ng∆∞·ªùi th∆∞∆°ng y√™u ƒëang hi·ªán di·ªán trong cu·ªôc s·ªëng c·ªßa b·∫°n m·ªói ng√†y.",
            "NƒÉm m·ªõi ch√∫c b·∫°n c√≥ kh·∫£ nƒÉng ch·ªØa l√†nh nh·ªØng v·∫øt th∆∞∆°ng l√≤ng trong qu√° kh·ª©. H√£y ƒë·ªÉ th·ªùi gian v√† t√¨nh y√™u th∆∞∆°ng xoa d·ªãu m·ªçi n·ªói ƒëau. Ch√∫c tr√°i tim b·∫°n nƒÉm 2026 s·∫Ω l√†nh l·∫∑n, m·∫°nh m·∫Ω v√† s·∫µn s√†ng rung ƒë·ªông tr∆∞·ªõc nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp m·ªôt l·∫ßn n·ªØa.",
            "Ch√∫c b·∫°n nƒÉm 2026 lu√¥n gi·ªØ ƒë∆∞·ª£c 'c√°i ƒë·∫ßu l·∫°nh v√† tr√°i tim n√≥ng'. B√¨nh tƒ©nh tr∆∞·ªõc m·ªçi s√≥ng gi√≥ v√† nhi·ªát huy·∫øt v·ªõi m·ªçi m·ª•c ti√™u. S·ª± c√¢n b·∫±ng n√†y s·∫Ω gi√∫p b·∫°n ƒëi xa h∆°n v√† v·ªØng v√†ng h∆°n tr√™n m·ªçi h√†nh tr√¨nh m√† b·∫°n l·ª±a ch·ªçn trong nƒÉm m·ªõi n√†y.",
            "NƒÉm m·ªõi ch√∫c b·∫°n c√≥ nh·ªØng kho·∫£nh kh·∫Øc tƒ©nh l·∫∑ng ƒë·ªÉ l·∫Øng nghe ti·∫øng n√≥i b√™n trong m√¨nh. ƒê·ª´ng ƒë·ªÉ s·ª± ·ªìn √†o c·ªßa th·∫ø gi·ªõi l·∫•n √°t ƒëi tr·ª±c gi√°c c·ªßa b·∫°n. Ch√∫c b·∫°n t√¨m th·∫•y s·ª± b√¨nh an n·ªôi t·∫°i v√† lu√¥n bi·∫øt r√µ con ƒë∆∞·ªùng m√¨nh c·∫ßn ph·∫£i ƒëi trong nƒÉm 2026.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm 2026 th·∫≠t phong c√°ch v√† ch·∫•t l·ª´. H√£y t·ª± tin th·ªÉ hi·ªán c√° t√≠nh, gu th·∫©m m·ªπ v√† phong c√°ch s·ªëng ri√™ng bi·ªát c·ªßa b·∫°n. Th·∫ø gi·ªõi n√†y c·∫ßn s·ª± ƒëa d·∫°ng, v√† b·∫°n ch√≠nh l√† m·ªôt m·∫£nh gh√©p ƒë·ªôc ƒë√°o kh√¥ng th·ªÉ thay th·∫ø. H√£y t·ªèa s√°ng nh√©!",
            "NƒÉm m·ªõi ch√∫c b·∫°n lu√¥n bao dung v√† v·ªã tha. Tha th·ª© cho ng∆∞·ªùi kh√°c c≈©ng l√† c√°ch t·ª± gi·∫£i tho√°t cho ch√≠nh m√¨nh. Mong t√¢m h·ªìn b·∫°n nƒÉm 2026 s·∫Ω r·ªông m·ªü nh∆∞ bi·ªÉn kh∆°i, kh√¥ng ch·∫•p nh·∫∑t nh·ªØng ƒëi·ªÅu nh·ªè nhen v√† lu√¥n h∆∞·ªõng t·ªõi nh·ªØng gi√° tr·ªã cao ƒë·∫πp, nh√¢n vƒÉn.",
            "Ch√∫c b·∫°n nƒÉm 2026 kh√°m ph√° ra nh·ªØng t√†i nƒÉng ti·ªÅm ·∫©n c·ªßa b·∫£n th√¢n m√† b·∫•y l√¢u nay b·∫°n ch∆∞a bi·∫øt. Con ng∆∞·ªùi b·∫°n l√† m·ªôt kho b√°u v√¥ t·∫≠n, h√£y khai ph√° v√† m√†i gi≈©a n√≥. Mong b·∫°n s·∫Ω ng·∫°c nhi√™n v√† t·ª± h√†o v·ªÅ nh·ªØng g√¨ m√¨nh c√≥ th·ªÉ l√†m ƒë∆∞·ª£c.",
            "NƒÉm m·ªõi ch√∫c b·∫°n c√≥ m·ªôt s·ª©c kh·ªèe tinh th·∫ßn th·∫≠t v·ªØng ch√£i. H√£y bi·∫øt c√°ch gi·∫£i t·ªèa cƒÉng th·∫≥ng, t√¨m ki·∫øm ni·ªÅm vui v√† gi·ªØ cho t√¢m tr√≠ lu√¥n trong tr·∫°ng th√°i t√≠ch c·ª±c. S·ª©c kh·ªèe tinh th·∫ßn t·ªët s·∫Ω l√† n·ªÅn t·∫£ng ƒë·ªÉ b·∫°n t·∫≠n h∆∞·ªüng cu·ªôc s·ªëng m·ªôt c√°ch tr·ªçn v·∫πn nh·∫•t.",
            "Ch√∫c b·∫°n m·ªôt nƒÉm 2026 'thu·∫≠n thi√™n th·ªùi, l·ª£i ƒë·ªãa l·ª£i, ƒë·∫°t nh√¢n h√≤a'. M·ªçi y·∫øu t·ªë thi√™n th·ªùi ƒë·ªãa l·ª£i nh√¢n h√≤a ƒë·ªÅu h·ªôi t·ª• ƒë·ªÉ gi√∫p b·∫°n th√†nh c√¥ng. Ch·ªâ c·∫ßn b·∫°n n·ªó l·ª±c h·∫øt m√¨nh, c·∫£ v≈© tr·ª• s·∫Ω chung tay gi√∫p ƒë·ª° b·∫°n ƒë·∫°t ƒë∆∞·ª£c m·ªçi mong ∆∞·ªõc trong nƒÉm nay.",
            "Cu·ªëi c√πng, ch√∫c b·∫°n m·ªôt nƒÉm 2026 h·∫°nh ph√∫c tr·ªçn v·∫πn t·ª´ng gi√¢y t·ª´ng ph√∫t. Kh√¥ng c·∫ßn qu√° gi√†u sang hay quy·ªÅn l·ª±c, ch·ªâ c·∫ßn m·ªói ng√†y tr√¥i qua b·∫°n ƒë·ªÅu th·∫•y l√≤ng m√¨nh b√¨nh y√™n v√† vui v·∫ª. ƒê√≥ m·ªõi ch√≠nh l√† th√†nh c√¥ng l·ªõn nh·∫•t c·ªßa ƒë·ªùi ng∆∞·ªùi. Ch√∫c m·ª´ng nƒÉm m·ªõi!"
        ];

        let userName = "";
        function typeWriter(text, elementId, speed = 40) {
            let i = 0;
            const element = document.getElementById(elementId);
            element.innerHTML = "";
            
            function type() {
                if (i < text.length) {
                    let char = text.charAt(i);
                    if (char === '\n') {
                        element.innerHTML += '<br>';
                    } else {
                        element.innerHTML += char;
                    }
                    i++;
                    setTimeout(type, speed);
                } else {
                    document.getElementById('letter-footer').style.opacity = 1;
                    const waitMsg = document.getElementById('wait-message');
                    waitMsg.style.display = 'block';
                    waitMsg.style.animation = 'twinkle 1s infinite alternate'; 
                    
                    // --- UPDATE: T·ª± ƒë·ªông chuy·ªÉn trang sau 5 gi√¢y ---
                    setTimeout(() => {
                        goToPage3(); 
                    }, 5000); 
                }
            }
            type();
        }

        // --- UPDATED: PAGE TRANSITION LOGIC ---
        function switchPage(hideId, showId) {
            const h = document.getElementById(hideId);
            const s = document.getElementById(showId);
            
            h.classList.add('page-exit');
            h.classList.remove('active'); 
            
            setTimeout(() => {
                h.classList.remove('page-exit');
                h.style.display = 'none'; 
                
                if (showId === 'page-3-interactive') {
                    s.style.display = 'block';
                    s.classList.add('page-enter'); 
                    setTimeout(() => s.classList.remove('page-enter'), 1000); 

                    // Fix: Reset scroll on entry
                    s.scrollTop = 0;

                    setTimeout(() => {
                        const sections = document.querySelectorAll('.interactive-section');
                        const observer = new IntersectionObserver((entries) => {
                            entries.forEach(entry => {
                                if (entry.isIntersecting) entry.target.classList.add('visible');
                            });
                        }, { threshold: 0.1 }); // Gi·∫£m threshold cho mobile d·ªÖ trigger
                        sections.forEach(sec => observer.observe(sec));
                    }, 100);
                } else {
                    s.classList.add('active');
                    s.classList.add('page-enter');
                    setTimeout(() => s.classList.remove('page-enter'), 1000);
                }
            }, 800);
        }

        function goToPage2() {
            const input = document.getElementById('name-input');
            if (input.value.trim() === "") { alert("H√£y nh·∫≠p t√™n ƒë·ªÉ ch√∫ng m√¨nh x∆∞ng h√¥ nh√©!"); return; }
            userName = input.value;
            document.getElementById('display-name').innerText = userName;
            
            switchPage('page-1', 'page-2');
            
            const randomWish = wishesList[Math.floor(Math.random() * wishesList.length)];
            const content = `Ch√†o ${userName}, l√† tui ƒë√¢y.\n\n${randomWish}\n\nB·∫°n c·ªßa tui,`;
            
            setTimeout(() => {
                typeWriter(content, "typewriter-text", 30); 
            }, 1200);
        }

        function goToPage3() { 
            switchPage('page-2', 'page-3-choice');
        }

        let windowMeteorEngine = null;
        function startInteractiveMode() {
            const choice = document.getElementById('page-3-choice');
            const interactive = document.getElementById('page-3-interactive');
            
            choice.classList.add('page-exit');
            setTimeout(() => {
                choice.classList.remove('active', 'page-exit'); 
                choice.style.display = 'none';
                
                interactive.style.display = 'block';
                interactive.scrollTop = 0; // ƒê·∫£m b·∫£o cu·ªôn l√™n ƒë·∫ßu
                interactive.classList.add('page-enter');
                setTimeout(() => interactive.classList.remove('page-enter'), 1000);

                initSteam(); initWindowStars();
                
                windowMeteorEngine = new MeteorEngine('window-meteor-canvas', true);

                const sections = document.querySelectorAll('.interactive-section');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) entry.target.classList.add('visible');
                    });
                }, { threshold: 0.1 });
                sections.forEach(sec => observer.observe(sec));
            }, 800);
        }

        function goToPage4() {
            const p3Choice = document.getElementById('page-3-choice');
            const p3Inter = document.getElementById('page-3-interactive');
            
            if(p3Choice.classList.contains('active')) {
                switchPage('page-3-choice', 'page-4');
            } else {
                p3Inter.classList.add('page-exit');
                setTimeout(() => {
                    p3Inter.style.display = 'none';
                    p3Inter.classList.remove('page-exit');
                    
                    const p4 = document.getElementById('page-4');
                    p4.classList.add('active', 'page-enter');
                    setTimeout(() => p4.classList.remove('page-enter'), 1000);
                }, 800);
            }
            setTimeout(startFinale, 1500);
        }

        // --- 3. INTERACTIVE LOGIC ---
        function initSteam() {
            const wishes = ["B√¨nh an", "S·ª©c kh·ªèe", "May m·∫Øn", "H·∫°nh ph√∫c", "Th√†nh c√¥ng", "Ti·ªÅn t√†i", "Vui v·∫ª"];
            const steamCont = document.getElementById('steam-container');
            setInterval(() => {
                if(document.hidden || steamCont.offsetParent === null) return;
                const el = document.createElement('div');
                el.className = 'steam';
                el.innerText = wishes[Math.floor(Math.random() * wishes.length)];
                
                el.style.left = (50 + (Math.random() * 20 - 10)) + '%';
                steamCont.appendChild(el);
                setTimeout(() => el.remove(), 4000);
            }, 2500);
        }

        function lightLamp() {
            const inp = document.getElementById('wish-input-old');
            const ashDisplay = document.getElementById('ash-display');
            const flm = document.getElementById('lamp-flame');
            
            if(inp && inp.value.trim()) {
                flm.classList.add('flare-up');
                ashDisplay.innerText = inp.value;
                inp.value = "";
                ashDisplay.classList.add('turn-to-ash');

                setTimeout(() => {
                    inp.placeholder = "Mu·ªôn phi·ªÅn ƒë√£ bu√¥ng b·ªè.";
                }, 800);
                setTimeout(() => { flm.classList.remove('flare-up'); }, 2000);
                setTimeout(() => {
                    ashDisplay.innerText = "";
                    ashDisplay.classList.remove('turn-to-ash');
                }, 3500);
            }
        }

        function initWindowStars() {
            const layer = document.getElementById('stars-layer-window');
            // Check if already inited
            if(layer.children.length > 0) return;

            for(let i=0; i<30; i++) {
                let s = document.createElement('div');
                s.style.position = 'absolute'; s.style.background = 'white'; s.style.borderRadius = '50%';
                s.style.width = Math.random()*2 + 'px'; s.style.height = s.style.width;
                s.style.left = Math.random()*100+'%';
                s.style.top = Math.random()*100+'%';
                s.style.opacity = Math.random();
                layer.appendChild(s);
            }
        }

        function sendWish() {
            const fb = document.getElementById('window-feedback');
            const inp = document.getElementById('reflection-input');
            
            if(inp && inp.value.trim()) {
                inp.value = "";
                inp.placeholder = "ƒê√£ g·ª≠i v√†o h∆∞ kh√¥ng...";
                fb.style.opacity = 1;
                if(windowMeteorEngine) {
                    for(let i=0; i<5; i++) {
                        setTimeout(() => windowMeteorEngine.shoot(true), i * 300);
                    }
                }
            }
        }

        function openEnvelope() {
            const quotes = [
                "S·ªëng r·ª±c r·ª° nh√©!",
                "T√¢m an, v·∫°n s·ª± an.",
                "M·∫°nh m·∫Ω v√† h·∫°nh ph√∫c.",
                "Ti·ªÅn ƒë·∫ßy t√∫i, t√¨nh ƒë·∫ßy tim.",
                "NƒÉm nay s·∫Ω t·ªët h∆°n nƒÉm c≈©.",
                "Lu√¥n y√™u ƒë·ªùi nh√©!"
            ];
            const note = document.getElementById('lucky-note');
            const env = document.querySelector('.envelope');
            if(note.style.display !== 'block') {
                note.innerText = quotes[Math.floor(Math.random() * quotes.length)];
                note.style.display = 'block';
                env.style.opacity = 0.5;
                env.style.transform = "scale(0.9)";
            }
        }

        // --- 4. FIREWORKS ENGINE ---
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        let rockets = [];
        let fireworksActive = false;
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();
        const palettes = {
            pureWhite: { base: [255, 255, 255], secondary: [200, 200, 255] },
            gold: { base: [255, 215, 0], secondary: [255, 250, 200] },
            fire: { base: [255, 69, 0], secondary: [255, 165, 0] },
            cool: { base: [0, 191, 255], secondary: [255, 255, 255] }
        };
        class Rocket {
            constructor() {
                this.x = Math.random() * width;
                this.y = height;
                this.destY = Math.random() * (height * 0.3) + height * 0.05;
                this.speed = Math.random() * 5 + 15; 
                this.vx = (Math.random() - 0.5) * 4; 
                this.vy = -this.speed;
                this.color = '255, 255, 255';
                this.trail = [];
                this.dead = false;
                this.gravity = 0.25;
            }
            update() {
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.trail.push({x: this.x, y: this.y, alpha: 1});
                if(this.trail.length > 8) this.trail.shift();
                this.trail.forEach(t => t.alpha -= 0.15);
                if (this.vy >= -2 || this.y <= this.destY) {
                    this.dead = true;
                    createExplosion(this.x, this.y);
                }
            }
            draw() {
                ctx.beginPath();
                for(let i=0; i<this.trail.length; i++) {
                    const t = this.trail[i];
                    ctx.fillStyle = `rgba(${this.color}, ${t.alpha})`;
                    ctx.fillRect(t.x, t.y, 2, 2);
                }
                ctx.fillStyle = `rgb(${this.color})`;
                ctx.fillRect(this.x, this.y, 3, 3);
            }
        }
        class Particle {
            constructor(x, y, v, colorArr, type) {
                this.x = x;
                this.y = y;
                this.vx = v.x; this.vy = v.y;
                this.rgb = colorArr;
                this.alpha = 1; this.friction = 0.95;
                this.gravity = 0.1; this.life = Math.random() * 30 + 80; 
                this.decay = Math.random() * 0.015 + 0.01;
                this.type = type;
            }
            update() {
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.vy += this.gravity; this.x += this.vx; this.y += this.vy;
                this.alpha -= this.decay;
                if(this.type === 'strobe' && Math.random() > 0.8) this.alpha = 1;
            }
            draw() {
                if (this.alpha <= 0) return;
                ctx.strokeStyle = `rgba(${this.rgb[0]}, ${this.rgb[1]}, ${this.rgb[2]}, ${this.alpha})`;
                ctx.lineWidth = 1.5; ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x - this.vx * 3, this.y - this.vy * 3);
                ctx.stroke();
            }
        }
        function createExplosion(x, y) {
            const types = ['sphere', 'starburst', 'ring'];
            const type = types[Math.floor(Math.random() * types.length)];
            const keys = Object.keys(palettes);
            const palette = palettes[keys[Math.floor(Math.random() * keys.length)]];
            const count = Math.floor(Math.random() * 50) + 120; 
            for (let i = 0; i < count; i++) {
                let speed = Math.random() * 8 + 2;
                let angle = Math.random() * Math.PI * 2;
                let vx, vy;
                if (type === 'ring') { speed = 6 + Math.random(); angle = (Math.PI * 2 / count) * i;
                } 
                vx = Math.cos(angle) * speed;
                vy = Math.sin(angle) * speed;
                if(type === 'starburst') { vx *= Math.random() * 0.5 + 0.5;
                vy *= Math.random() * 0.5 + 0.5; }
                const color = (Math.random() > 0.3) ?
                palette.base : palette.secondary;
                const pType = (Math.random() > 0.8) ? 'strobe' : 'normal';
                particles.push(new Particle(x, y, {x: vx, y: vy}, color, pType));
            }
            ctx.globalCompositeOperation = 'lighter';
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.beginPath(); ctx.arc(x, y, 30, 0, Math.PI*2); ctx.fill();
        }
        function loop() {
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = 'rgba(10, 10, 10, 0.2)'; 
            ctx.fillRect(0, 0, width, height);
            ctx.globalCompositeOperation = 'lighter';
            if (fireworksActive && Math.random() < 0.05) rockets.push(new Rocket());
            for (let i = rockets.length - 1; i >= 0; i--) {
                rockets[i].update();
                rockets[i].draw();
                if (rockets[i].dead) rockets.splice(i, 1);
            }
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].alpha <= 0) particles.splice(i, 1);
            }
            requestAnimationFrame(loop);
        }
        loop();
        
        function startFinale() {
            fireworksActive = true;
            for(let k=0; k<15; k++) setTimeout(() => rockets.push(new Rocket()), k*100);
            
            const hny = document.getElementById('happy-new-year');
            hny.style.opacity = 1;
            hny.style.transform = "scale(1.1)";
        }
    </script>
</body>
</html>